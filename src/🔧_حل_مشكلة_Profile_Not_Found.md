# ๐ง ุญู ูุดููุฉ "Profile not found in database"

## โ ุงููุดููุฉ

ุนูุฏ ูุญุงููุฉ ุชุณุฌูู ุงูุฏุฎููุ ุชุธูุฑ ุงูุฃุฎุทุงุก ุงูุชุงููุฉ:
```
โ [AuthContext] Profile not found in database
โ๏ธ Edge Function not deployed, using Supabase fallback...
```

---

## ๐ฏ ุงูุณุจุจ

**ูุง ููุฌุฏ ูุณุชุฎุฏููู ูู ุฌุฏูู `profiles` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช!**

ุญุชู ูู ูุงู ููุงู ูุณุชุฎุฏููู ูู `auth.users`ุ ูุฌุจ ุฃู ูููู ูุฏููู profiles!

---

## โ ุงูุญู ุงูุณุฑูุน (3 ุทุฑู)

### ุงูุทุฑููุฉ 1: ุฅูุดุงุก ูุณุชุฎุฏู ูู ูุงุฌูุฉ ุงููุธุงู (ุงูุฃุณูู) โก

1. **ุงูุชุญ ุงููุธุงู:**
   ```
   http://localhost:5173
   ```

2. **ุงุถุบุท "ุชุณุฌูู ุญุณุงุจ ุฌุฏูุฏ"**

3. **ุงููุฃ ุงูุจูุงูุงุช:**
   - ุงูุงุณู ุงููุงูู: `ุฃุญูุฏ ูุญูุฏ`
   - ุงูุจุฑูุฏ: `test@kku.edu.sa`
   - ูููุฉ ุงููุฑูุฑ: `test123`
   - ุงูุฏูุฑ: `Admin` ุฃู `Student`
   - ุงูุฑูู ุงูุฌุงูุนู (ููุทูุงุจ ููุท): `441234567`

4. **ุงุถุบุท "ุชุณุฌูู"**

5. **โ ุชู!** ุณูุชู:
   - ุฅูุดุงุก ุงููุณุชุฎุฏู ูู `auth.users`
   - ุฅูุดุงุก Profile ูู `profiles`
   - ุชุณุฌูู ุงูุฏุฎูู ุชููุงุฆูุงู
   - ุงูุงูุชูุงู ูููุญุฉ ุงูุชุญูู

---

### ุงูุทุฑููุฉ 2: ุงุณุชุฎุฏุงู SQL Script (ููุตู ุจู) ๐๏ธ

**ูู Supabase Dashboard:**

1. **ุงูุชุญ Supabase Dashboard:**
   ```
   https://supabase.com/dashboard/project/pcymgqdjbdklrikdquih
   ```

2. **ุงุฐูุจ ุฅูู: SQL Editor**

3. **ุงูุชุญ ููู: `create-demo-users.sql`**

4. **ุงูุณุฎ ุงููุญุชูู ูุงูุตูู ูู SQL Editor**

5. **ุงุถุบุท "Run"**

6. **โ ุชู!** ุณูุชู ุฅูุดุงุก 4 ูุณุชุฎุฏููู:
   - `admin@kku.edu.sa` / `admin123`
   - `instructor@kku.edu.sa` / `instructor123`
   - `student@kku.edu.sa` / `student123`
   - `supervisor@kku.edu.sa` / `supervisor123`

---

### ุงูุทุฑููุฉ 3: ูู Terminal ูุจุงุดุฑุฉ ๐ป

```bash
# ุชูููุฐ SQL Script
psql -h aws-0-eu-central-1.pooler.supabase.com \
     -p 6543 \
     -d postgres \
     -U postgres.pcymgqdjbdklrikdquih \
     -f create-demo-users.sql

# ุงุฏุฎู ูููุฉ ูุฑูุฑ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนูุฏ ุงูุทูุจ
```

**โ ุชู!** ุฌููุน ุงููุณุชุฎุฏููู ุฌุงูุฒูู!

---

## ๐งช ุงูุชุญูู ูู ุงููุฌุงุญ

### ูู SQL Editor:

```sql
-- ุนุฑุถ ุฌููุน ุงููุณุชุฎุฏููู
SELECT 
  p.id,
  p.email,
  p.full_name,
  p.role,
  p.university_id
FROM profiles p;
```

**ูุฌุจ ุฃู ุชุฑู:**
```
| email                  | full_name      | role       |
|------------------------|----------------|------------|
| admin@kku.edu.sa       | ูุฏูุฑ ุงููุธุงู    | admin      |
| instructor@kku.edu.sa  | ุฏ. ุฃุญูุฏ ูุญูุฏ   | instructor |
| student@kku.edu.sa     | ูุญูุฏ ุนุจุฏุงููู   | student    |
| supervisor@kku.edu.sa  | ุฏ. ูุงุทูุฉ ุนูู   | supervisor |
```

---

## ๐ ุงูุขู ุณุฌู ุงูุฏุฎูู!

### ุงูุฎุทูุงุช:

1. **ุงูุชุญ ุงููุธุงู:**
   ```
   http://localhost:5173
   ```

2. **ุงุถุบุท "ุชุณุฌูู ุงูุฏุฎูู"**

3. **ุงุณุชุฎุฏู ุฃู ูู ุงูุญุณุงุจุงุช:**

   **Admin:**
   - ุงูุจุฑูุฏ: `admin@kku.edu.sa`
   - ูููุฉ ุงููุฑูุฑ: `admin123`

   **Instructor:**
   - ุงูุจุฑูุฏ: `instructor@kku.edu.sa`
   - ูููุฉ ุงููุฑูุฑ: `instructor123`

   **Student:**
   - ุงูุจุฑูุฏ: `student@kku.edu.sa`
   - ูููุฉ ุงููุฑูุฑ: `student123`

   **Supervisor:**
   - ุงูุจุฑูุฏ: `supervisor@kku.edu.sa`
   - ูููุฉ ุงููุฑูุฑ: `supervisor123`

4. **โ ุณูุชู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ!**
   - ุณูุธูุฑ ุชุญุฐูุฑ: "ุงููุธุงู ุงูุฎููู ุบูุฑ ููุดูุฑ" (ุทุจูุนู!)
   - ุณุชูุชูู ุชููุงุฆูุงู ูููุญุฉ ุงูุชุญูู ุงูููุงุณุจุฉ

---

## ๐ ููู ุงููุดููุฉ

### ููุงุฐุง ุญุฏุซุช ุงููุดููุฉุ

1. **Edge Function ุบูุฑ ููุดูุฑ** (ุทุจูุนู)
2. **ุงููุธุงู ูุณุชุฎุฏู Fallback** (ุฌูุฏ!)
3. **ููู ุฌุฏูู `profiles` ูุงุฑุบ** (ุงููุดููุฉ!)

### ุงูุญู ุงูุฐู ุชู ุชุทุจููู:

ุชู ุชุญุฏูุซ `AuthContext.tsx` ููุฏุนู:

1. โ **Signup ุจุฏูู Edge Function:**
   - ููุดุฆ ุงููุณุชุฎุฏู ูู `auth.users`
   - ููุดุฆ Profile ูู `profiles`
   - ูุณุฌู ุงูุฏุฎูู ุชููุงุฆูุงู

2. โ **Login ุจุฏูู Edge Function:**
   - ูุชุญูู ูู `auth.users`
   - ููุฑุฃ Profile ูู `profiles`
   - ูุนุฑุถ ุชุญุฐูุฑ ูุงุถุญ

3. โ **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ:**
   - ุจุงููุบุชูู (ุนุฑุจู/ุฅูุฌููุฒู)
   - ูุน ุฅุฑุดุงุฏุงุช ููุญู

---

## ๐ ูุง ุงูุฐู ุชู ุชุญุฏูุซูุ

### ูู `AuthContext.tsx`:

#### 1. ุชุญุฏูุซ `signUp`:
```typescript
// ุฅุฐุง Edge Function ุบูุฑ ููุฌูุฏ
if (apiError.message === 'EDGE_FUNCTION_NOT_DEPLOYED') {
  // ุงุณุชุฎุฏุงู Supabase ูุจุงุดุฑุฉ
  const { data: authData } = await supabase.auth.signUp({
    email,
    password,
    options: {
      data: { full_name, role, university_id }
    }
  });
  
  // ุฅูุดุงุก Profile
  await supabase.from('profiles').insert({
    id: authData.user.id,
    email,
    full_name,
    role,
    university_id
  });
}
```

#### 2. ุชุญุฏูุซ `refreshUser`:
```typescript
// ุฅุฐุง Edge Function ุบูุฑ ููุฌูุฏ
if (apiError.message === 'EDGE_FUNCTION_NOT_DEPLOYED') {
  // ูุฑุงุกุฉ ูุจุงุดุฑุฉ ูู profiles
  const { data: profile } = await supabase
    .from('profiles')
    .select('*')
    .eq('id', authUser.user.id)
    .single();
  
  if (profile) {
    setUser(profile);
    setToken(session.access_token);
  }
}
```

---

## ๐ฏ ุงูุฎูุงุตุฉ

### ุงููุดููุฉ:
- โ Profile not found in database

### ุงูุณุจุจ:
- โ ุฌุฏูู `profiles` ูุงุฑุบ

### ุงูุญู:
- โ ุฅูุดุงุก ูุณุชุฎุฏููู (3 ุทุฑู)
- โ ุชุญุฏูุซ `AuthContext.tsx` ูุฏุนู Fallback ูู Signup

### ุงููุชูุฌุฉ:
- โ ุชุณุฌูู ุงูุฏุฎูู ูุนูู
- โ ุฅูุดุงุก ุญุณุงุจ ูุนูู
- โ ุฌููุน ุงูููุฒุงุช ุชุนูู

---

## ๐ก ูุตุงุฆุญ ุฅุถุงููุฉ

### 1. ููุงุฎุชุจุงุฑ ุงูุณุฑูุน:
ุงุณุชุฎุฏู ุงูุญุณุงุจุงุช ุงูุฌุงูุฒุฉ ูู `create-demo-users.sql`

### 2. ููุงุณุชุฎุฏุงู ุงูุญูููู:
ุฃูุดุฆ ุญุณุงุจุงุช ูู ูุงุฌูุฉ ุงููุธุงู

### 3. ููุฅูุชุงุฌ:
- โ ุบูุฑ ูููุงุช ุงููุฑูุฑ
- โ ุงูุดุฑ Edge Function
- โ ูุนูู ุงูููุฒุงุช ุงูุฃูููุฉ

---

## ๐ ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ

### ุชุญูู ูู:

1. **ุฌุฏูู profiles ููุฌูุฏ:**
   ```sql
   SELECT * FROM profiles LIMIT 1;
   ```

2. **ุงููุณุชุฎุฏู ููุฌูุฏ ูู auth:**
   ```sql
   SELECT * FROM auth.users WHERE email = 'test@kku.edu.sa';
   ```

3. **Console ูู ุงููุชุตูุญ (F12):**
   - ุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุฎุทุฃ
   - ุดุงุฑู ุงูุฑุณุงุฆู ูุนู

---

## โจ ุชู ุจุญูุฏ ุงููู!

**ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ูุงูู!** ๐

**ุฎุทูุงุช ุงูุงุณุชุฎุฏุงู:**

1. โ ุฃูุดุฆ ูุณุชุฎุฏููู (ุฃู ุทุฑููุฉ ูู ุงูุซูุงุซุฉ)
2. โ ุดุบู ุงููุธุงู: `npm run dev`
3. โ ุณุฌู ุงูุฏุฎูู
4. โ ุงุณุชูุชุน ุจุงููุธุงู!

**ุจุงูุชูููู!** ๐โค๏ธ
